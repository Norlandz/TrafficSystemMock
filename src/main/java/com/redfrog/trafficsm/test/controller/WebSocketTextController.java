package com.redfrog.trafficsm.test.controller;

import java.time.Instant;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.messaging.handler.annotation.MessageMapping;
import org.springframework.messaging.handler.annotation.Payload;
import org.springframework.messaging.handler.annotation.SendTo;
import org.springframework.messaging.simp.SimpMessagingTemplate;
import org.springframework.web.bind.annotation.CrossOrigin;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RestController;

import com.redfrog.trafficsm.controller.MoveVehicleWebController;
import com.redfrog.trafficsm.message.config.WebSocketConfig;
import com.redfrog.trafficsm.test.model.TextMessageDTO;

@RestController
@CrossOrigin(origins = MoveVehicleWebController.url_JsVite_CrossOrigin)
public class WebSocketTextController {

  public final static String ws_TopicFolder_cpss_AA = "/cpss_msg";
  public final static String ws_TopicFolder_spcs_AA = "/spcs_msg";

  @Autowired
  SimpMessagingTemplate template;

  @PostMapping("/http_endpoint_delegate_to_ws")
  public ResponseEntity<Void> sendMessage(@RequestBody TextMessageDTO textMessageDTO) {
    textMessageDTO.setMessage(textMessageDTO.getMessage() + "-" + "HH" + Instant.now());
    System.out.println("@PostMapping" + " :: " + textMessageDTO);
    template.convertAndSend(WebSocketConfig.ws_BrokerTopic_ServerPubClientSub + ws_TopicFolder_spcs_AA, textMessageDTO);
    return new ResponseEntity<>(HttpStatus.OK);
  }

  //__________________________________________________________________________________________________
  @MessageMapping(ws_TopicFolder_cpss_AA)
  public void sub_ClientPubServerSubMsg(@Payload TextMessageDTO textMessageDTO) {
    textMessageDTO.setMessage(textMessageDTO.getMessage() + "-" + "AN");
    System.out.println("@MessageMapping" + " :: " + textMessageDTO);
  }

  //______________
  @SendTo(WebSocketConfig.ws_BrokerTopic_ServerPubClientSub + ws_TopicFolder_spcs_AA)
  public TextMessageDTO pub_ServerPubClientSubMsg(@Payload TextMessageDTO textMessageDTO) {
    textMessageDTO.setMessage(textMessageDTO.getMessage() + "-" + "DR");
    System.out.println("@SendTo" + " :: " + textMessageDTO);
    return textMessageDTO;

  }

}

//_____________________________________________________________________________________________________________________________
//______________
//________________________________________________________________________
//_________________
//_________________________________________
//_________
//
//_____________________________________________
//________________________________________________________________________________________________________________
//________________________________________________________________________________________
//___________________________________________________________________________________________
//_______________________________________________________________________________
//_____________________________________________
//______________________

//____________________________
//___________________________________________
//________________________________________________________________________________________
//______________
//_________________________
//__________________________________________________________________________________
//______________________________________________________
//___________________________________________________________________
//_________________
//______________
//_________________________
//____________________________________________________________________________________
//________________________________
//_______________________________________________________________________________________________________
//___________________________________
//____________________________________________________________________________________
//_________________
//______________
//_______________
//______________
//_____________________________
//_____________________________________________________________
//____________________________________________________
//______________
//__________________________
//_______________________________________________
//______________
//_____________________________________
//_____________________________________________________________________________________________________
//________________________________________________________________
//____________________________________________________________________________
//_____________________________________________________________
//_________________
//______________
//_______________________________________________
//____________________________________________________________________________________
//________________________________________________
//__________________________________________________________________________
//_________________
//______________
//_________________________________________
//________________________________________________________________________________________________
//____________________________________________________________________
//________________________________________
//______________
//_________________
//______________
//_______________
//______________
//______________________
//___________________________________________________________________________________________________________________________________________
//______________
//__________________________________________________________________________________
//_______________________________________________________
//___________________
//______________
//_______________________________________
//______________________________________________________________________________________________________________________
//_____________________________________________
//_______________________________________________
//_______________________________________________________________________
//_____________________________________
//____________________________________________________________
//_______________________________________________
//_______________________________________________________________________________
//_________________________
//_______________________
//_______________________
//____________________
//______________
//________________________________________________
//__________________________________________________
//____________________
//______________
//_____________________________________________
//__________________________________________
//_________________________________________
//____________________________________________
//____________________________________________
//___________________________________________
//_________________________________________________
//_____________________
//______________
//____________________________________
//_______________________
//______________
//_______________________________________________________________
//________________________________________________
//_________________________________________________________________________________________________________________
//___________________________________________________________________________________________
//______________________________
//______________________________________
//________________________
//________________________
//__________________________________________________
//__________________________________________________
//_____________________
//___________________________________
//______________________
//_____________________
//________________________________
//___________________________________________________________
//________________________
//_____________________
//____________________
//_________________